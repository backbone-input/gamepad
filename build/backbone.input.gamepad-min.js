!function(e,t,a,n){var i,o="undefined"!=typeof n&&"undefined"!=typeof n.View,d=o?n.View:a.View,s=o?n.Layout:!1,p=navigator.getGamepads||navigator.webkitGetGamepads||!1,r={xbox:["A","B","X","Y","LeftShoulder","RightShoulder","LeftTrigger","RightTrigger","Back","Start","LeftThumbstick","RightThumbstick","DPad_Up","DPad_Down","DPad_Left","DPad_Right"],playstation:[],steam:[]},m=d.prototype.params||new a.Model;m.set({gamepads:{}});var c,u={monitorGamepad:function(a){"undefined"==typeof a&&(a=!0),a&&p?(e.addEventListener("gamepadconnected",t.bind(this._onConnectGamepad,this)),e.addEventListener("gamepaddisconnected",t.bind(this._onDisconnectGamepad,this)),i=setInterval(t.bind(this._scanGamepads,this),500)):(e.removeEventListener("gamepadconnected"),e.removeEventListener("gamepaddisconnected"),clearInterval(i))},onConnectGamepad:function(){},onDisconnectGamepad:function(){},_onConnectGamepad:function(e){var a=t.inArray("gamepad",this.options.monitor);if(!a)return this.monitorGamepad(!1);var n=e.gamepad||e.detail.gamepad;e.detail.gamepad&&(e.gamepad=e.detail.gamepad),t.inDebug()&&console.log("connect",e),e.stopPropagation&&e.stopPropagation();var i=this.params.get("gamepads");return i[n.index]=n,this.params.set({gamepads:i}),this.onConnectGamepad?this.onConnectGamepad(e):void 0},_onDisconnectGamepad:function(e){var a=t.inArray("gamepad",this.options.monitor);if(!a)return this.monitorGamepad(!1);t.inDebug()&&console.log("disconnect",e),e.stopPropagation&&e.stopPropagation();var n=this.params.get("gamepads");return delete n[e.gamepad.index],this.params.set({gamepads:n}),this.trigger("gamepaddisconnected",e),this.onDisconnectGamepad?this.onDisconnectGamepad(e):void 0},_scanGamepads:function(){for(var t=p.call(navigator),a=this.params.get("gamepads"),n=0;n<t.length;n++)if(t[n])if(t[n].index in a)a[t[n].index]=t[n];else{var i=new CustomEvent("gamepadconnected",{detail:{gamepad:t[n]}});e.dispatchEvent(i)}this.params.set({gamepads:a})},_updateGamepads:function(a){var n=t.inArray("gamepad",this.options.monitor);return n?(this.trigger("updateGamepads",a),this.updateGamepads&&this.updateGamepads(a),void h.call(e,t.bind(this._updateGamepads,this))):this.monitorGamepad(!1)},_buttonKey:function(e){return r.xbox[e]}},g=d.extend(t.extend({},u,{options:{monitor:[]},params:m,state:{gamepadButtons:[]},initialize:function(e){return e.monitor&&t.extend(this.options.monitor,e.monitor),t.inArray("gamepad",this.options.monitor)&&(this.monitorGamepad(),h(t.bind(this._updateGamepads,this))),d.prototype.initialize.call(this,e)}}));s&&(c=s.extend(t.extend({},u,{options:{monitor:[]},params:m,state:{gamepadButtons:[]},initialize:function(e){return e.monitor&&t.extend(this.options.monitor,e.monitor),t.inArray("gamepad",this.options.monitor)&&(this.monitorGamepad(),h(t.bind(this._updateGamepads,this))),s.prototype.initialize.call(this,e)}}))),t.mixin({inArray:function(e,t){return t instanceof Array?t.indexOf(e)>-1:!1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG}});var h=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame;t.isUndefined(a.Input)&&(a.Input={}),a.Input.Gamepad=g,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=g:"function"==typeof define&&define.amd&&define([],function(){return g}),"object"==typeof e&&"object"==typeof e.document&&(o?(n.View=g,n.Layout=c,n.Input=n.Input||{},n.Input.Gamepad=a.Input.Gamepad,e.APP=n):a.View=g,e.Backbone=a)}(this.window,this._,this.Backbone,this.APP);