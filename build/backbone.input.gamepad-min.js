!function(t,e,a,n){var i,o="undefined"!=typeof n&&"undefined"!=typeof n.View,d=o?n.View:a.View,s=o?n.Layout:!1,p=navigator.getGamepads||navigator.webkitGetGamepads||!1,r={xbox:["A","B","X","Y","LeftShoulder","RightShoulder","LeftTrigger","RightTrigger","Back","Start","LeftThumbstick","RightThumbstick","DPad_Up","DPad_Down","DPad_Left","DPad_Right"],playstation:[],steam:[]},m=d.prototype.params||new a.Model;m.set({gamepads:{}});var c,u={monitorGamepad:function(a){"undefined"==typeof a&&(a=!0),a&&p?(t.addEventListener("gamepadconnected",e.bind(this._onConnectGamepad,this)),t.addEventListener("gamepaddisconnected",e.bind(this._onDisconnectGamepad,this)),i=setInterval(e.bind(this._scanGamepads,this),500)):(t.removeEventListener("gamepadconnected"),t.removeEventListener("gamepaddisconnected"),clearInterval(i))},onClickGamepad:function(){},onConnectGamepad:function(){},onDisconnectGamepad:function(){},_onConnectGamepad:function(t){var a=e.inArray("gamepad",this.options.monitor);if(!a)return this.monitorGamepad(!1);var n=t.gamepad||t.detail.gamepad;t.detail&&(t.gamepad=t.detail.gamepad),e.inDebug()&&console.log("connect",t),t.stopPropagation&&t.stopPropagation();var i=this.params.get("gamepads");return i[n.index]=n,this.params.set({gamepads:i}),this.onConnectGamepad?this.onConnectGamepad(t):void 0},_onDisconnectGamepad:function(t){var a=e.inArray("gamepad",this.options.monitor);if(!a)return this.monitorGamepad(!1);e.inDebug()&&console.log("disconnect",t),t.stopPropagation&&t.stopPropagation();var n=this.params.get("gamepads");return delete n[t.gamepad.index],this.params.set({gamepads:n}),this.trigger("gamepaddisconnected",t),this.onDisconnectGamepad?this.onDisconnectGamepad(t):void 0},_scanGamepads:function(){for(var e=p.call(navigator),a=this.params.get("gamepads"),n=0;n<e.length;n++)if(e[n])if(e[n].index in a)a[e[n].index]=e[n];else{var i=new CustomEvent("gamepadconnected",{detail:{gamepad:e[n]}});t.dispatchEvent(i)}this.params.set({gamepads:a})},_updateGamepads:function(a){var n=e.inArray("gamepad",this.options.monitor);return n?(this.trigger("updateGamepads",a),this.updateGamepads&&this.updateGamepads(a),void g.call(t,e.bind(this._updateGamepads,this))):this.monitorGamepad(!1)},_buttonKey:function(t){return r.xbox[t]}},h=d.extend(e.extend({},u,{options:{monitor:[]},params:m,state:{gamepadButtons:[]},initialize:function(t){return t=t||{},e.bindAll(this,"onClickGamepad"),t.monitor&&e.extend(this.options.monitor,t.monitor),e.inArray("gamepad",this.options.monitor)&&(this.monitorGamepad(),g(e.bind(this._updateGamepads,this)),this.on("gamepadclick",this.onClickGamepad)),d.prototype.initialize.call(this,t)}}));s&&(c=s.extend(e.extend({},u,{options:{monitor:[]},params:m,state:{gamepadButtons:[]},initialize:function(t){return t=t||{},t.monitor&&e.extend(this.options.monitor,t.monitor),e.inArray("gamepad",this.options.monitor)&&(this.monitorGamepad(),g(e.bind(this._updateGamepads,this)),this.on("gamepadclick",this.onClickGamepad)),s.prototype.initialize.call(this,t)}}))),e.mixin({inArray:function(t,e){return e instanceof Array?e.indexOf(t)>-1:!1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG}});var g=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame;e.isUndefined(a.Input)&&(a.Input={}),a.Input.Gamepad=h,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=h:"function"==typeof define&&define.amd&&define([],function(){return h}),"object"==typeof t&&"object"==typeof t.document&&(o?(n.View=h,n.Layout=c,n.Input=n.Input||{},n.Input.Gamepad=a.Input.Gamepad,t.APP=n):a.View=h,t.Backbone=a)}(this.window,this._,this.Backbone,this.APP);